<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Título por defecto; las páginas pueden sobreescribir con <title layout:fragment="title"> -->
  <title layout:fragment="title" th:text="${pageTitle} ?: 'Residuos Sólidos - Frontera de la Paz'">Residuos Sólidos - Frontera de la Paz</title>

  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <meta name="description" th:content="${pageDescription != null ? pageDescription : 'Gestión de residuos sólidos en la frontera de la paz'}">

  <!-- Tipografía Nunito: preconnect + fallback a Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <!-- Self-hosted Nunito (woff2) -->

  <!-- Preload recursos críticos -->
  <!-- Preload de CSS críticos (sin fuentes locales) -->
  <link rel="preload" th:href="@{/css/typography.css(v=2)}" href="/css/typography.css?v=2" as="style">
  <link rel="preload" th:href="@{/css/index.css(v=2)}" href="/css/index.css?v=2" as="style">
  <link rel="preload" th:if="${heroImage != null and !#strings.isEmpty(heroImage)}" th:href="${heroImage}" as="image">

  <!-- Tipografía y estilos globales/componentes -->
  <!-- Tailwind via CDN (con plugin line-clamp). Debe ir antes de los estilos personalizados. -->
  <script src="https://cdn.tailwindcss.com?plugins=line-clamp"></script>
  <link rel="stylesheet" th:href="@{/css/typography.css(v=2)}" href="/css/typography.css?v=2">
  <link rel="stylesheet" th:href="@{/css/index.css(v=2)}" href="/css/index.css?v=2">
  <link rel="stylesheet" th:href="@{/css/button.css(v=1)}" href="/css/button.css?v=1" media="print" onload="this.media='all'">
  <link rel="stylesheet" th:href="@{/css/card.css(v=1)}" href="/css/card.css?v=1" media="print" onload="this.media='all'">
  <link rel="stylesheet" th:href="@{/css/badge.css(v=1)}" href="/css/badge.css?v=1" media="print" onload="this.media='all'">
  
  
  
  <!-- Punto de extensión para CSS extra por página -->
  <th:block layout:fragment="head-extra"></th:block>
  
  <!-- Debug layout outlines via class on body -->
  <style>
    body.debug-outlines * { outline: 1px solid rgba(0,0,0,0.25) !important; }
    body.debug-outlines .container, body.debug-outlines .hero, body.debug-outlines .hero-media, body.debug-outlines .hero-content, body.debug-outlines .hero-content-inner,
    body.debug-outlines .steps, body.debug-outlines .step, body.debug-outlines .notes-header, body.debug-outlines .notes-grid, body.debug-outlines .card, body.debug-outlines .card-media, body.debug-outlines .card-body,
    body.debug-outlines .lang-switch, body.debug-outlines header, body.debug-outlines main, body.debug-outlines footer, body.debug-outlines nav, body.debug-outlines section, body.debug-outlines article, body.debug-outlines aside {
      outline: 2px solid #000 !important;
    }
    /* No dibujar outline sobre la capa de overlay del hero */
    body.debug-outlines .overlay { outline: none !important; }
  </style>
  
  <!-- Debug layout outlines: activar con ?debug=1 -->
  <th:block th:if="${param.debug != null}">
    <style>
      /* Borde fino para todos los elementos */
      * { outline: 1px solid rgba(0,0,0,0.25) !important; }
      /* Borde más notorio para bloques clave */
      .container, .hero, .hero-media, .hero-content, .hero-content-inner,
      .steps, .step, .notes-header, .notes-grid, .card, .card-media, .card-body,
      .lang-switch, header, main, footer, nav, section, article, aside {
        outline: 2px solid #000 !important;
      }
    </style>
  </th:block>
</head>
<body>
  <!-- Contenido de la página -->
  <main id="app" layout:fragment="content">
    <!-- El contenido de cada página se inyectará aquí -->
  </main>

  <!-- Toggle flotante para activar/desactivar modo debug -->
  <button id="debugToggleBtn" type="button"
          class="fixed bottom-4 right-4 z-50 btn btn-outline btn-sm bg-white/90 backdrop-blur rounded-full shadow hover:shadow-md"
          aria-pressed="false" title="Alternar bordes de debug">
    Debug
  </button>

  <!-- Scripts globales (ligeros) -->
  <!-- Cache-busting para asegurar última versión del language-switcher -->
  <script th:src="@{/js/language-switcher.js(v=3)}" src="/js/language-switcher.js?v=3" defer></script>

  <script>
    (function() {
      const KEY = 'debugOutlines';
      const btn = document.getElementById('debugToggleBtn');
      const body = document.body;

      function setState(enabled) {
        if (enabled) {
          body.classList.add('debug-outlines');
          btn.setAttribute('aria-pressed', 'true');
          btn.textContent = 'Debug: ON';
        } else {
          body.classList.remove('debug-outlines');
          btn.setAttribute('aria-pressed', 'false');
          btn.textContent = 'Debug: OFF';
        }
        try { localStorage.setItem(KEY, enabled ? '1' : '0'); } catch (e) {}
      }

      // Init from localStorage or URL ?debug=1
      let init = false;
      try { init = localStorage.getItem(KEY) === '1'; } catch (e) {}
      const urlHasDebug = new URLSearchParams(window.location.search).has('debug');
      if (urlHasDebug) init = true;
      setState(init);

      btn.addEventListener('click', function() {
        setState(!body.classList.contains('debug-outlines'));
      });
    })();
  </script>
  

  <!-- Punto de extensión para JS extra por página -->
  <th:block layout:fragment="body-scripts"></th:block>
</body>
</html>
