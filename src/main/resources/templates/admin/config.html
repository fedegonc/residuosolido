<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/layout :: head('Configuración del Sitio')}"></head>
<body th:replace="~{fragments/layout :: layout(~{::content})}">
    <div th:fragment="content">
        <!-- Encabezado simple -->
        <div class="bg-gray-50 py-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-gray-900">Configuración del Sitio</h1>
                </div>
                <!-- Breadcrumbs -->
                <nav class="mt-2" aria-label="Breadcrumb">
                    <ol class="flex items-center text-sm text-gray-500">
                        <li>
                            <a href="/dashboard" class="hover:text-gray-700">Admin Dashboard</a>
                        </li>
                        <li class="px-2">/</li>
                        <li class="text-gray-700 font-medium" aria-current="page">Configuración</li>
                    </ol>
                </nav>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        
        <script th:inline="none">
            function showHeroPreview(input) {
                console.log('showHeroPreview llamada');
                console.log('Input:', input);
                console.log('Input files:', input.files);
                
                const container = document.getElementById('hero-preview-container');
                const heroImagePreview = document.getElementById('heroImagePreview');
                const heroPreviewImg = document.getElementById('heroPreviewImg');
                
                console.log('Container:', container);
                console.log('HeroImagePreview:', heroImagePreview);
                console.log('HeroPreviewImg:', heroPreviewImg);
                
                if (input.files && input.files[0]) {
                    const file = input.files[0];
                    console.log('Archivo seleccionado:', file.name, file.type);
                    
                    if (file.type.startsWith('image/')) {
                        console.log('Es una imagen válida');
                        // Mostrar mensaje de confirmación
                        const selectionMessage = document.getElementById('hero-selection-message');
                        if (selectionMessage) {
                            selectionMessage.classList.remove('hidden');
                            console.log('Mensaje de confirmación mostrado');
                        }
                        if (container) {
                            container.style.display = 'block';
                            console.log('Container mostrado');
                        }
                        
                        // Reemplazar imagen actual
                        const currentHeroImage = document.getElementById('current-hero-image');
                        if (currentHeroImage) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                // Cambiar a imagen de fondo
                                currentHeroImage.style.backgroundImage = `url(${event.target.result})`;
                                currentHeroImage.className = 'w-full h-32 rounded-lg border bg-cover bg-center';
                                // Ocultar texto si existe
                                const span = currentHeroImage.querySelector('span');
                                if (span) span.style.display = 'none';
                                console.log('Imagen actual reemplazada');
                            };
                            reader.readAsDataURL(file);
                        }
                    } else {
                        console.log('No es una imagen válida');
                        if (container) {
                            container.style.display = 'none';
                        }
                        const selectionMessage = document.getElementById('hero-selection-message');
                        if (selectionMessage) {
                            selectionMessage.classList.add('hidden');
                        }
                    }
                } else {
                    console.log('No hay archivos seleccionados');
                }
            }
        </script>

            <!-- Mensajes -->
            <div th:if="${success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                <span th:text="${success}"></span>
            </div>
            <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <span th:text="${error}"></span>
            </div>

            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Gestión de Imágenes del Hero</h2>
                
                <!-- Imagen activa actual -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Imagen Activa Actual:</label>
                    <div id="current-hero-image" 
                         th:class="${heroImage != null and !heroImage.isEmpty()} ? 'w-full h-32 rounded-lg border bg-cover bg-center' : 'w-full h-32 rounded-lg border bg-gradient-to-br from-green-700 via-green-600 to-green-500 flex items-center justify-center'" 
                         th:style="${heroImage != null and !heroImage.isEmpty()} ? 'background-image: url(' + heroImage + ')' : ''">
                        <span th:if="${heroImage == null or heroImage.isEmpty()}" class="text-white font-medium">Sin imagen personalizada (usando gradiente por defecto)</span>
                    </div>
                </div>

                <!-- Subir nueva imagen -->
                <form th:action="@{/admin/config/hero-image}" method="post" enctype="multipart/form-data" class="mb-6">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Subir Nueva Imagen
                        </label>
                        <input type="file" id="heroImageFile" name="heroImageFile" accept="image/*" 
                               class="hidden" onchange="showHeroPreview(this)">
                        <button type="button" onclick="console.log('Botón clickeado'); var input = document.getElementById('heroImageFile'); console.log('Input encontrado:', input); if(input) { input.click(); console.log('Input clickeado'); } else { console.log('Input NO encontrado!'); }" 
                                class="mb-2 inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Seleccionar Archivo
                        </button>
                        <p class="mt-1 text-sm text-gray-500">Formatos soportados: JPG, PNG, GIF. Tamaño recomendado: 1920x600px</p>
                        <div id="hero-preview-container" class="mt-2" style="display: none;">
                            <p class="text-sm text-green-600">Nueva imagen seleccionada</p>
                        </div>
                    </div>
                    
                    <!-- Mensaje de confirmación -->
                    <div id="hero-selection-message" class="mb-4 hidden">
                        <p class="text-sm text-green-600 font-medium">✓ Nueva imagen seleccionada - La imagen se actualizará al guardar</p>
                    </div>
                    
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                        Subir Imagen
                    </button>
                </form>

                <!-- Galería de imágenes -->
                <div th:if="${heroImages != null and !heroImages.isEmpty()}">
                    <h3 class="text-md font-semibold text-gray-900 mb-3">Galería de Imágenes</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div th:each="image : ${heroImages}" class="relative border rounded-lg overflow-hidden">
                            <div class="h-24 bg-cover bg-center" th:style="'background-image: url(' + ${image.imageUrl} + ')'">
                                <div th:if="${image.active}" class="absolute top-2 left-2 bg-green-600 text-white px-2 py-1 text-xs rounded">
                                    ACTIVA
                                </div>
                            </div>
                            <div class="p-3">
                                <p class="text-xs text-gray-500 mb-2" th:text="${#temporals.format(image.uploadDate, 'dd/MM/yyyy HH:mm')}"></p>
                                <div class="flex gap-2">
                                    <form th:if="${!image.active}" th:action="@{/admin/posts/config/activate/{id}(id=${image.id})}" method="post" class="inline">
                                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 text-xs rounded">
                                            Activar
                                        </button>
                                    </form>
                                    <form th:action="@{/admin/posts/config/delete/{id}(id=${image.id})}" method="post" class="inline" onsubmit="return confirm('¿Eliminar imagen?')">
                                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 text-xs rounded">
                                            Eliminar
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                
            </div>
        </div>
    </div>
    
    <!-- Función movida al head para estar disponible -->
</body>
</html>
