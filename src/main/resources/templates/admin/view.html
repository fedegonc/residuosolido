<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="es">
<head th:replace="~{fragments/admin-layout :: head('Detalle de Usuario')}"></head>
<body th:replace="~{fragments/admin-layout :: layout(~{::content})}">
    <div th:fragment="content">

        <!-- Encabezado simple + Breadcrumbs -->
        <div class="bg-gray-50 py-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-900">Detalle de Usuario</h1>
                </div>
                <nav class="mt-2" aria-label="Breadcrumb" th:if="${user}">
                    <ol class="flex items-center text-sm text-gray-500">
                        <li><a href="/admin/dashboard" class="hover:text-gray-700">Admin Dashboard</a></li>
                        <li class="px-2">/</li>
                        <li><a href="/admin/users" class="hover:text-gray-700">Usuarios</a></li>
                        <li class="px-2">/</li>
                        <li><a th:href="@{'/admin/users/edit/' + ${user.id}}" class="hover:text-gray-700">Editar Usuario</a></li>
                        <li class="px-2">/</li>
                        <li class="text-gray-700 font-medium" aria-current="page">Detalle</li>
                    </ol>
                </nav>
            </div>
        </div>

        <!-- Contenido principal -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6" th:if="${user}">
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <div class="flex items-center mb-4">
                    <svg class="h-8 w-8 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-800">Información del Usuario</h2>
                </div>

                <!-- Avatar + Identidad -->
                <div class="flex items-center gap-4 mb-6" th:if="${user}">
                    <img class="h-24 w-24 rounded-full object-cover border border-gray-200"
                         th:src="${(user.profileImage != null and !#strings.isEmpty(user.profileImage))
                                   ? user.profileImage
                                   : 'https://ui-avatars.com/api/?name=' +
                                     ((user.firstName != null ? user.firstName : user.username) + ' ' + (user.lastName != null ? user.lastName : '')) +
                                     '&background=10b981&color=ffffff&size=96'}"
                         th:attr="onerror=|this.onerror=null;this.src='https://ui-avatars.com/api/?name=${#strings.isEmpty(user.firstName) ? user.username : user.firstName + ' ' + (user.lastName == null ? '' : user.lastName)}&background=10b981&color=ffffff&size=96'|"
                         alt="Avatar" />
                    <div>
                        <div class="text-lg font-semibold text-gray-900" th:text="${(user.firstName != null ? user.firstName : '') + ' ' + (user.lastName != null ? user.lastName : '')}">Nombre Apellido</div>
                        <div class="text-sm text-gray-500" th:text="${'@' + user.username}">@usuario</div>
                    </div>
                </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Sección Información Básica -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-lg font-medium text-gray-700 mb-3">Información Básica</h2>
                    <div class="space-y-2">
                        <p><span class="font-medium">Nombre:</span> 
                            <span th:text="${user.firstName + ' ' + user.lastName}"></span>
                        </p>
                        <p><span class="font-medium">Email:</span> <span th:text="${user.email}"></span></p>
                        <p><span class="font-medium">Rol:</span> <span th:text="${user.role}"></span></p>
                        <p><span class="font-medium">Estado:</span> 
                            <span th:if="${user.active}" class="text-green-600">Activo</span>
                            <span th:unless="${user.active}" class="text-red-600">Inactivo</span>
                        </p>
                    </div>
                </div>
                
                <!-- Sección Estadísticas -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-lg font-medium text-gray-700 mb-3">Estadísticas</h2>
                    <div class="space-y-2">
                        <p><span class="font-medium">Creado:</span>
                           <span th:text="${user.createdAt != null ? #temporals.format(user.createdAt, 'dd/MM/yyyy HH:mm') : '—'}"></span>
                        </p>
                        <p><span class="font-medium">Último acceso:</span>
                           <span th:text="${user.lastAccessAt != null ? #temporals.format(user.lastAccessAt, 'dd/MM/yyyy HH:mm') : 'Sin registros de acceso — registrado el ' + #temporals.format(user.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                        </p>
                        <p th:if="${userFeedbackCount > 0}"><span class="font-medium">Feedbacks enviados:</span>
                            <span th:text="${userFeedbackCount}"></span>
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 flex flex-wrap gap-3">
                <a th:href="@{/admin/users}" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50">Volver a Usuarios</a>
                <a th:href="@{'/admin/users/edit/' + ${user.id}}" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">Editar Usuario</a>
            </div>
        </div>
    </div>
</body>
</html>
