<!-- Fragmento de formulario de login -->
<section th:fragment="loginForm" class="bg-white rounded-lg">
  <header class="mb-4">
    <h2 class="text-lg font-semibold text-gray-900" th:text="#{nav.login}">Iniciar Sesión</h2>
  </header>

  <form th:action="@{/auth/login}" method="post" class="space-y-3">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <!-- Username -->
    <label for="username" class="block">
      <span class="block text-xs font-semibold text-gray-700 mb-1 flex items-center gap-1.5">
        <i class="fa-solid fa-user text-[13px]" aria-hidden="true"></i>
        <span th:text="#{login.username.label}">Usuario</span>
      </span>
      <input type="text"
             id="username"
             name="username"
             required
             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-green-500 focus:border-green-500 text-sm"
             th:placeholder="#{login.username.placeholder}">
    </label>

    <!-- Password -->
    <label for="password" class="block">
      <span class="block text-xs font-semibold text-gray-700 mb-1 flex items-center gap-1.5">
        <i class="fa-solid fa-lock text-[13px]" aria-hidden="true"></i>
        <span th:text="#{login.password.label}">Contraseña</span>
      </span>
      <div class="relative" data-password-container>
        <input type="password"
               id="password"
               name="password"
               required
               class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-green-500 focus:border-green-500 text-sm"
               th:placeholder="#{login.password.placeholder}">
        <button type="button"
                class="absolute inset-y-0 right-3 flex items-center text-gray-400 hover:text-gray-600"
                data-password-toggle
                data-target="password"
                aria-label="Alternar visibilidad de la contraseña"
                aria-pressed="false">
          <i class="fa-solid fa-eye text-sm" aria-hidden="true"></i>
          <span class="sr-only" th:text="#{auth.password.toggle}">Mostrar u ocultar contraseña</span>
        </button>
      </div>
    </label>

    <!-- Submit Button (fragmento primaryButtonFull) -->
    <div th:replace="~{fragments/components/buttons :: primaryButtonFull(#{nav.login})}"></div>
  </form>

  <!-- Links -->
  <footer class="mt-4 space-y-1.5">
    <p class="text-xs text-gray-600">
      <a href="/auth/forgot-password" class="text-green-600 hover:text-green-700" th:text="#{login.forgot_password}">¿Olvidaste tu contraseña?</a>
    </p>
  </footer>

  <script>
    (function(){
      function togglePassword(btn){
        const targetId = btn.getAttribute('data-target');
        const input = document.getElementById(targetId);
        if(!input) return;
        const isPwd = input.getAttribute('type') === 'password';
        input.setAttribute('type', isPwd ? 'text' : 'password');
        btn.setAttribute('aria-pressed', String(isPwd));
        try {
          const icon = btn.querySelector('i');
          if (icon) {
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
          }
        } catch(_){}
      }
      document.addEventListener('click', function(e){
        const btn = e.target.closest('[data-password-toggle]');
        if(btn) {
          e.preventDefault();
          togglePassword(btn);
        }
      });
    })();
  </script>
  <p class="text-xs text-gray-600">
      <span th:text="#{login.no_account}">¿No tienes cuenta?</span>
      <a href="/auth/register" class="text-green-600 hover:text-green-700 font-medium" th:text="#{login.register_link}">Regístrate aquí</a>
    </p>
  </footer>
</section>
