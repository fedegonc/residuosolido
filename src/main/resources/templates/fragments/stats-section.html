<!-- Fragmento: Sección de Estadísticas -->
<section th:fragment="stats" class="py-8 bg-white">
    <div class="max-w-6xl mx-auto px-6">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <!-- Usuarios Activos -->
            <div class="text-center p-4">
                <div class="text-2xl font-bold text-green-600 mb-1 counter" data-target="1247">0</div>
                <div class="text-xs text-gray-600">Usuarios Activos</div>
            </div>

            <!-- Solicitudes Completadas -->
            <div class="text-center p-4">
                <div class="text-2xl font-bold text-blue-600 mb-1 counter" data-target="2891">0</div>
                <div class="text-xs text-gray-600">Solicitudes Completadas</div>
            </div>

            <!-- Organizaciones -->
            <div class="text-center p-4">
                <div class="text-2xl font-bold text-purple-600 mb-1 counter" data-target="23">0</div>
                <div class="text-xs text-gray-600">Organizaciones</div>
            </div>

            <!-- Materiales Procesados -->
            <div class="text-center p-4">
                <div class="text-2xl font-bold text-orange-600 mb-1">
                    <span class="counter" data-target="15">0</span>
                    <span class="text-lg">k kg</span>
                </div>
                <div class="text-xs text-gray-600">Materiales Procesados</div>
            </div>
        </div>
    </div>
</section>

<!-- JavaScript para animaciones -->
<script th:fragment="stats-js">
document.addEventListener('DOMContentLoaded', function() {
    // Función para animar contadores
    function animateCounter(element) {
        const target = parseInt(element.getAttribute('data-target'));
        const duration = 2000; // 2 segundos
        const step = target / (duration / 16); // 60fps
        let current = 0;
        
        const timer = setInterval(() => {
            current += step;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            element.textContent = Math.floor(current).toLocaleString();
        }, 16);
    }

    // Función para animar barra de satisfacción
    function animateSatisfactionBar() {
        const bar = document.querySelector('.satisfaction-bar');
        if (bar) {
            setTimeout(() => {
                bar.style.width = '84%'; // 4.2/5 = 84%
                bar.style.transition = 'width 2s ease-out';
            }, 500);
        }
    }

    // Intersection Observer para activar animaciones cuando sea visible
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Animar contadores
                const counters = entry.target.querySelectorAll('.counter');
                counters.forEach(counter => {
                    animateCounter(counter);
                });
                
                // Animar barra de satisfacción
                animateSatisfactionBar();
                
                // Desconectar observer después de la primera animación
                observer.unobserve(entry.target);
            }
        });
    }, {
        threshold: 0.5
    });

    // Observar la sección de estadísticas
    const statsSection = document.querySelector('[th\\:fragment="stats"]');
    if (statsSection) {
        observer.observe(statsSection);
    }
});
</script>
