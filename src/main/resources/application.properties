# PERFIL ACTIVO - Cambiar a 'test' para desarrollo local

# Base de datos SQLite (modo archivo, persistente)
# Multipart (subida de archivos)
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.config.import=optional:file:.env[.properties]
# PostgreSQL datasource via environment variables
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=${SPRING_DATASOURCE_DRIVER_CLASS_NAME:org.postgresql.Driver}

# Configuración optimizada de Hikari Connection Pool
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.pool-name=ResiduoSolidoHikariCP
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.keepalive-time=300000

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=${SPRING_JPA_DATABASE_PLATFORM:org.hibernate.dialect.PostgreSQLDialect}
spring.jpa.show-sql=false
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.open-in-view=false

# Thymeleaf optimizado para desarrollo
spring.thymeleaf.cache=false
spring.thymeleaf.mode=HTML
logging.level.org.thymeleaf=WARN
logging.level.org.thymeleaf.templateresolver=WARN
logging.level.org.thymeleaf.TemplateEngine=WARN
logging.level.org.thymeleaf.standard=WARN
logging.level.org.springframework.web.servlet.view=WARN

# DevTools habilitado para desarrollo (auto-restart y LiveReload)
spring.devtools.restart.enabled=true
spring.devtools.livereload.enabled=true
spring.devtools.restart.additional-paths=src/main/resources/templates,src/main/resources/static
spring.devtools.restart.poll-interval=1000
spring.devtools.restart.quiet-period=400


# ☁️ Cloudinary - con valores por defecto para desarrollo
cloudinary.cloud_name=${CLOUDINARY_CLOUD_NAME:}
cloudinary.api_key=${CLOUDINARY_API_KEY:}
cloudinary.api_secret=${CLOUDINARY_API_SECRET:}

# 📁 Ubicación estática base y optimización de recursos
spring.web.resources.static-locations=file:src/main/resources/static/

# Optimización de recursos estáticos
spring.web.resources.chain.enabled=true
spring.web.resources.chain.strategy.content.enabled=true
spring.web.resources.chain.strategy.content.paths=/**
spring.web.resources.chain.strategy.fixed.enabled=true
spring.web.resources.chain.strategy.fixed.paths=/**
spring.web.resources.chain.strategy.fixed.version=v1
spring.web.resources.cache.period=31536000
spring.web.resources.cache.cachecontrol.max-age=31536000
spring.web.resources.cache.cachecontrol.cache-public=true
spring.web.resources.cache.cachecontrol.no-cache=true

# HTTP tuning y compresión para mejorar rendimiento
server.http2.enabled=true
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# Codificación UTF-8 para evitar caracteres raros en parámetros (logout, etc.)
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true
server.tomcat.uri-encoding=UTF-8

# Timeouts más claros en MVC async (si aplica)
spring.mvc.async.request-timeout=60000

# Habilitar access log de Tomcat para correlación
server.tomcat.accesslog.enabled=false
server.tomcat.basedir=.
server.tomcat.accesslog.directory=logs
server.tomcat.accesslog.prefix=access
server.tomcat.accesslog.suffix=.log
server.tomcat.accesslog.pattern=%h %l %u %t "%r" %s %b %D reqId=%{X-Request-Id}i

# Incluir requestId del MDC en el patrón de log (si tu app usa logback)
logging.pattern.level=%5p [reqId=%X{requestId}]

# Logs de rendimiento
logging.level.com.residuosolido.app=WARN
logging.level.org.springframework.web=WARN
logging.level.org.springframework.web.servlet.DispatcherServlet=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n